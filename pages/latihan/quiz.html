<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/circle.png" type="image/x-icon">
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00897B"/>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <!-- Main CSS -->
    <link rel="stylesheet" href="/assets/css/course.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@9.10.0/dist/sweetalert2.min.css">

    <title>Latihan - Lingkaran</title>
    <style>
      .slide{
        position: absolute;
        left: 0px;
        top: 0px;
        width: 100%;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.1s;
      }
      .active-slide{
        opacity: 1;
        z-index: 2;
      }
      .card {
        position: relative;
      }
      .quiz-container{
        position: relative;
        height: 400px;
        margin-top: 10px;
      }
      .question{
        font-size: 16px;
        margin-bottom: 10px;
      }
      .answers {
        margin-bottom: 20px;
        text-align: left;
        display: inline-block;
      }
      .answers label{
        display: block;
        margin-bottom: 10px;
      }
      @media only screen and(max-width: 500px){
        .quiz-container{
          height: 500px;
        }
      }
      @media only screen and(max-width: 300px){
        .quiz-container{
          height: 700px;
        }
      }
  </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light" id="nav">
      
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
      <div class="row">
        <div class="col-lg-10 col-sm-12 my-2">
          <div class="card h-100 shadow">
            <div class="card-body">
              <div class="quiz-container">
                <div id="quiz"></div>
              </div>
              <hr>
              <div class="btn-action text-center">
                <button id="back" class="btn btn-md btn-secondary shadow">Kembali</button>
                <button id="next" class="btn btn-md btn-success shadow" >Selanjutnya</button>
                
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-2 col-sm-12 my-2">
          <div class="card h-100 shadow">
            <div class="card-body text-center">
              <div id="time" class="badge bg-dark fw-bold" style="font-size: 1em;">00 : 00</div>
              <hr>
              <span class="number-btn"></span>
              <hr>
              <button id="submit" class="btn btn-md btn-danger end shadow">Selesai</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Content -->

    <!-- Bootstrap JS -->
    <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- JS Component -->
    <script src="/components/navbar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9.10.0/dist/sweetalert2.min.js"></script>
    <script src="/pages/latihan/soal.js"></script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script>
      let randomQuestion = questions.sort((a, b) => {return 0.5 - Math.random()});

      function buildQuiz() {
        const output = [];
        let currentNumber = 1;

        randomQuestion.forEach((currentQuestion, questionNumber) => {
          const answers = [];

          for(letter in currentQuestion.answers) {
            answers.push(
              `
                <label>
                  <input type="radio" name="question${questionNumber}" value="${letter}" data="${currentNumber}" class="answer">
                  <span>${letter}. ${currentQuestion.answers[letter]}<span>
                </label>
              `
            );
          }

          output.push(
            `
              <div class="slide">
                <div class="question">${currentNumber}. ${currentQuestion.question}</div>
                <br>
                <div class="answers">${answers.join("")}</div>
              </div>
            `
          );
            
          currentNumber++;
        });
        questionContainer.innerHTML = output.join("");
        // MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
      }

      function results() {
        const answerContainers = questionContainer.querySelectorAll(".answers");

        let numCorrect = 0;
        let numWrong = 0;

        randomQuestion.forEach((currentQuestion, questionNumber) => {
          const answerContainer = answerContainers[questionNumber];

          const selector = `input[name=question${questionNumber}]:checked`;
          const userAnswer = (answerContainer.querySelector(selector) || {}).value;

          if(userAnswer === currentQuestion.correctAnswer) {
            numCorrect++;
          } else {
            numWrong++;
          }

          sessionStorage.setItem('questionLength', randomQuestion.length);
          sessionStorage.setItem('correct', numCorrect);
          sessionStorage.setItem('wrong', numWrong);
          location.href = './result.html';
        });
      }

      function showSlide(n) {
        const bhm = document.getElementById(`number-btn${currentSlide}`);
        const bhm2 = document.getElementById(`number-btn${n}`);
        if(bhm){
          document.getElementById(`number-btn${currentSlide}`).classList.remove('active');
        }
        if(bhm2){
          document.getElementById(`number-btn${n}`).classList.add('active');
        }
      
        slides[currentSlide].classList.remove('active-slide');
        slides[n].classList.add('active-slide');

        const answerContainers = questionContainer.querySelectorAll(".answers");
        const answerContainer = answerContainers[currentSlide];
        const selector = `input[name=question${currentSlide}]:checked`;
        const userAnswer = (answerContainer.querySelector(selector) || {}).value;
        if (userAnswer != undefined) {
          nomorSoal[currentSlide].classList.add('btn-success');
          nomorSoal[currentSlide].classList.remove('btn-outline-secondary');
        }
        currentSlide = n;

        if(currentSlide === 0) {
          backButton.style.display = "none";
        } else {
          backButton.style.display = "inline-block";
        }

        if(currentSlide === slides.length - 1) {
          nextButton.style.display = "none";
          // submitButton.style.display = "inline-block";
        } else {
          nextButton.style.display = "inline-block";
          // submitButton.style.display = "none";
        }
      }

      function nextSlide() {
        showSlide(currentSlide + 1);
      }

      function backSlide() {
        showSlide(currentSlide - 1);
      }

      function paginationSlide(n) {
        showSlide(n);
      }

      let questionContainer = document.querySelector("#quiz");
      let nextButton = document.querySelector("#next"); 
      let backButton = document.querySelector("#back"); 
      let submitButton = document.querySelector("#submit");
      
      buildQuiz();

      const slides = document.querySelectorAll(".slide");
      let currentSlide = 0;

      showSlide(currentSlide);
      backButton.addEventListener("click", backSlide);
      nextButton.addEventListener("click", nextSlide);
      submitButton.addEventListener("click", function(){
        Swal.fire({
          title: 'Apa kamu yakin mengakhiri menjawab?',
          text: "",
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Iya',
          cancelButtonText: 'Batal'
          }).then((result) => {
          if (result.value) {
            results()
          }
        });
      });

      let numberButton = document.querySelector(".number-btn");
      for(i=0;i<randomQuestion.length; i++) {
        let li = document.createElement("span");
        li.innerHTML = `<button type="button" id="number-btn${i}" class="btn btn-md btn-outline-secondary mx-1 mt-2 nomor-soal" onclick="paginationSlide(${i})">${i+1}</button>`;
        numberButton.appendChild(li);
      }
      let nomorSoal = document.querySelectorAll('.nomor-soal');

      const showTime = document.querySelector("#time")
      let startMinutes = 60
      let seconds = 00
      function countdown() {
        setTimeout(countdown, 1000);
        seconds = seconds < 10 ? `0${seconds}` : seconds;
        showTime.innerHTML = `${startMinutes} : ${seconds}`;

        seconds--
        if(seconds < 0) {
          seconds = 59;
          startMinutes--;
        }

        if(startMinutes < 0) {
          startMinutes = 0;
          seconds = 0;
        }

        if(startMinutes === 0 && seconds === 0) {
          results();
        }
      }
      countdown();

      const nama = sessionStorage.getItem('nama');
      if (nama === "") {
        location.href = './'
      }
    </script>
  </body>
</html>